<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Boletim Escolar - Lançamento e consulta de notas">

  <meta http-equiv="Cache-Control" content="no-cache, must-revalidate">
  <meta name="deploy-version" content="v2.3.0-boletim">

  <title>Boletim Escolar - Sistema de Gestão Escolar</title>
  <link rel="icon" type="image/jpeg" href="../assets/images/logo-escola.jpeg">

  <!-- CSS -->
  <link rel="stylesheet" href="../assets/css/style.css">
  <link rel="stylesheet" href="../assets/css/components.css">
  <link rel="stylesheet" href="../assets/css/dashboard.css">
  <link rel="stylesheet" href="../assets/css/modern-layout.css">

  <!-- Scripts do sistema -->
  <script src="../assets/js/fix-emoji-titles.js"></script>
  <script src="../assets/js/modern-topbar.js"></script>
  <script src="../netlify-env.js" onerror="console.log('Variáveis do Netlify não encontradas')"></script>
  <script src="../assets/js/env-config.js"></script>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script src="../assets/js/unified-auth.js"></script>
  <script src="../assets/js/supabase-only.js"></script>
  <script src="../assets/js/cache-buster.js"></script>

  <style>
    .nota-input {
      width: 80px;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 6px;
      text-align: center;
      font-size: 14px;
    }

    .nota-input:focus {
      outline: none;
      border-color: #8b5cf6;
      box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
    }

    .materia-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      margin-bottom: 8px;
    }

    .materia-row:hover {
      background: rgba(139, 92, 246, 0.1);
    }

    .materia-label {
      font-weight: 500;
      color: #e0e0e0;
      flex: 1;
    }

    .boletim-card {
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(139, 92, 246, 0.05));
      border: 1px solid rgba(139, 92, 246, 0.3);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .boletim-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(139, 92, 246, 0.2);
    }

    .nota-display {
      font-size: 24px;
      font-weight: bold;
      color: #8b5cf6;
      text-align: center;
      padding: 10px;
    }

    .status-aprovado {
      color: #10b981;
      font-weight: bold;
    }

    .status-reprovado {
      color: #ef4444;
      font-weight: bold;
    }

    .media-geral {
      background: linear-gradient(135deg, #8b5cf6, #6d28d9);
      color: white;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      margin-top: 20px;
    }

    .media-geral h3 {
      margin: 0 0 10px 0;
      font-size: 18px;
    }

    .media-geral .valor {
      font-size: 48px;
      font-weight: bold;
      margin: 10px 0;
    }

    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      border-bottom: 2px solid rgba(139, 92, 246, 0.2);
    }

    .tab {
      padding: 12px 24px;
      background: transparent;
      border: none;
      color: #9ca3af;
      cursor: pointer;
      font-size: 16px;
      font-weight: 500;
      transition: all 0.3s;
      border-bottom: 2px solid transparent;
      margin-bottom: -2px;
    }

    .tab:hover {
      color: #8b5cf6;
    }

    .tab.active {
      color: #8b5cf6;
      border-bottom-color: #8b5cf6;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
      animation: fadeIn 0.3s;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .materias-grid {
      display: grid;
      gap: 10px;
      max-height: 500px;
      overflow-y: auto;
      padding-right: 10px;
    }

    .materias-grid::-webkit-scrollbar {
      width: 8px;
    }

    .materias-grid::-webkit-scrollbar-track {
      background: rgba(139, 92, 246, 0.1);
      border-radius: 4px;
    }

    .materias-grid::-webkit-scrollbar-thumb {
      background: rgba(139, 92, 246, 0.5);
      border-radius: 4px;
    }

    .consulta-results {
      display: grid;
      gap: 15px;
    }

    .nota-card {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      padding: 15px;
      border: 1px solid rgba(139, 92, 246, 0.2);
    }

    .nota-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .nota-card-title {
      font-size: 16px;
      font-weight: 600;
      color: #e0e0e0;
    }

    .nota-card-value {
      font-size: 28px;
      font-weight: bold;
      color: #8b5cf6;
    }
  </style>
</head>
<body>
  <!-- Topbar -->
  <div class="top-bar">
    <div class="top-bar-left">
      <div class="app-launcher">
        <span></span><span></span><span></span>
        <span></span><span></span><span></span>
        <span></span><span></span><span></span>
      </div>
      <span class="app-name">Boletim Escolar</span>
      <span class="school-name">Escola Estadual Cívico-Militar Jupiara</span>
    </div>
    <div class="top-bar-right">
      <div class="user-profile" title="Usuário">A</div>
      <button id="btnLogout" class="btn-logout" style="margin-left:12px;">Sair</button>
    </div>
  </div>

  <div class="main-layout">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-section">
        <div class="sidebar-title">Módulos Principais</div>
        <a href="../index.html" class="sidebar-item"><span class="sidebar-icon">🏠</span><span class="sidebar-text">Dashboard</span></a>
        <a href="gestao-alunos.html" class="sidebar-item"><span class="sidebar-icon">👥</span><span class="sidebar-text">Gestão de Alunos</span></a>
        <a href="medidas-disciplinares.html" class="sidebar-item"><span class="sidebar-icon">📋</span><span class="sidebar-text">Medidas Disciplinares</span></a>
        <a href="consulta-ficha.html" class="sidebar-item"><span class="sidebar-icon">👤</span><span class="sidebar-text">Ficha Disciplinar</span></a>
        <a href="frequencia.html" class="sidebar-item"><span class="sidebar-icon">📅</span><span class="sidebar-text">Controle de Frequência</span></a>
        <a href="boletim.html" class="sidebar-item active"><span class="sidebar-icon">📚</span><span class="sidebar-text">Boletim Escolar</span></a>
        <a href="relatorios.html" class="sidebar-item"><span class="sidebar-icon">📊</span><span class="sidebar-text">Relatórios</span></a>
        <a href="analises.html" class="sidebar-item"><span class="sidebar-icon">📈</span><span class="sidebar-text">Análises</span></a>
      </div>
      <div class="sidebar-section">
        <div class="sidebar-title">Ferramentas</div>
        <a href="configuracoes.html" class="sidebar-item"><span class="sidebar-icon">⚙️</span><span class="sidebar-text">Configurações</span></a>
        <a href="comunicacao.html" class="sidebar-item"><span class="sidebar-icon">📱</span><span class="sidebar-text">Comunicação</span></a>
        <a href="#" id="sidebarLogout" class="sidebar-item"><span class="sidebar-icon">🚪</span><span class="sidebar-text">Logout</span></a>
      </div>
    </div>

    <!-- Content Area -->
    <div class="content-area">
      <div class="main-content">
        <div class="module-title">📚 Boletim Escolar</div>

        <!-- Tabs -->
        <div class="tabs">
          <button class="tab active" data-tab="lancamento">📝 Lançamento de Notas</button>
          <button class="tab" data-tab="consulta">📊 Consulta de Notas</button>
        </div>

        <!-- TAB: Lançamento -->
        <div id="tab-lancamento" class="tab-content active">
          <div class="management-section">
            <div class="management-title">📝 Lançar Notas</div>

            <div class="form-grid">
              <div class="form-group">
                <label>Ano Letivo</label>
                <input type="number" id="lancamento-ano" value="2025" min="2020" max="2030" class="form-input">
              </div>

              <div class="form-group">
                <label>Turma</label>
                <select id="lancamento-turma" class="form-input">
                  <option value="">Selecione uma turma</option>
                  <optgroup label="Ensino Fundamental">
                    <option value="6º Ano A">6º Ano A</option>
                    <option value="6º Ano B">6º Ano B</option>
                    <option value="7º Ano A">7º Ano A</option>
                    <option value="7º Ano B">7º Ano B</option>
                    <option value="8º Ano A">8º Ano A</option>
                    <option value="8º Ano B">8º Ano B</option>
                    <option value="9º Ano A">9º Ano A</option>
                    <option value="9º Ano B">9º Ano B</option>
                    <option value="9º Ano E">9º Ano E</option>
                  </optgroup>
                  <optgroup label="Ensino Médio">
                    <option value="1º Ano A">1º Ano A</option>
                    <option value="1º Ano B">1º Ano B</option>
                    <option value="1º Ano C">1º Ano C</option>
                    <option value="2º Ano A">2º Ano A</option>
                    <option value="2º Ano B">2º Ano B</option>
                  </optgroup>
                </select>
              </div>

              <div class="form-group">
                <label>Aluno</label>
                <select id="lancamento-aluno" class="form-input" disabled>
                  <option value="">Selecione uma turma primeiro</option>
                </select>
              </div>

              <div class="form-group">
                <label>Bimestre</label>
                <select id="lancamento-bimestre" class="form-input">
                  <option value="">Selecione o bimestre</option>
                  <option value="1">1º Bimestre</option>
                  <option value="2">2º Bimestre</option>
                  <option value="3">3º Bimestre</option>
                  <option value="4">4º Bimestre</option>
                </select>
              </div>
            </div>

            <div id="materias-container" style="display: none; margin-top: 20px;">
              <h3 style="color: #8b5cf6; margin-bottom: 15px;">Notas das Matérias</h3>
              <div id="materias-list" class="materias-grid"></div>

              <div style="margin-top: 20px; display: flex; gap: 10px;">
                <button id="btn-salvar-notas" class="btn btn-success">💾 Salvar Notas</button>
                <button id="btn-limpar" class="btn btn-secondary">🔄 Limpar</button>
              </div>
            </div>
          </div>
        </div>

        <!-- TAB: Consulta -->
        <div id="tab-consulta" class="tab-content">
          <div class="management-section">
            <div class="management-title">📊 Consultar Notas</div>

            <div class="form-grid">
              <div class="form-group">
                <label>Ano Letivo</label>
                <input type="number" id="consulta-ano" value="2025" min="2020" max="2030" class="form-input">
              </div>

              <div class="form-group">
                <label>Turma</label>
                <select id="consulta-turma" class="form-input">
                  <option value="">Selecione uma turma</option>
                  <optgroup label="Ensino Fundamental">
                    <option value="6º Ano A">6º Ano A</option>
                    <option value="6º Ano B">6º Ano B</option>
                    <option value="7º Ano A">7º Ano A</option>
                    <option value="7º Ano B">7º Ano B</option>
                    <option value="8º Ano A">8º Ano A</option>
                    <option value="8º Ano B">8º Ano B</option>
                    <option value="9º Ano A">9º Ano A</option>
                    <option value="9º Ano B">9º Ano B</option>
                    <option value="9º Ano E">9º Ano E</option>
                  </optgroup>
                  <optgroup label="Ensino Médio">
                    <option value="1º Ano A">1º Ano A</option>
                    <option value="1º Ano B">1º Ano B</option>
                    <option value="1º Ano C">1º Ano C</option>
                    <option value="2º Ano A">2º Ano A</option>
                    <option value="2º Ano B">2º Ano B</option>
                  </optgroup>
                </select>
              </div>

              <div class="form-group">
                <label>Aluno</label>
                <select id="consulta-aluno" class="form-input" disabled>
                  <option value="">Selecione uma turma primeiro</option>
                </select>
              </div>

              <div class="form-group">
                <label>Bimestre</label>
                <select id="consulta-bimestre" class="form-input">
                  <option value="">Selecione o bimestre</option>
                  <option value="1">1º Bimestre</option>
                  <option value="2">2º Bimestre</option>
                  <option value="3">3º Bimestre</option>
                  <option value="4">4º Bimestre</option>
                  <option value="anual">Média Anual</option>
                </select>
              </div>
            </div>

            <div style="margin-top: 15px;">
              <button id="btn-consultar" class="btn btn-primary">🔍 Consultar Boletim</button>
            </div>

            <div id="resultado-consulta" style="margin-top: 30px; display: none;"></div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- Script do Boletim -->
  <script src="../assets/js/boletim.js"></script>

  <!-- Guard de autenticação -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Verificar autenticação
      if (!window.supabaseSystem.auth.requireAuth()) {
        return;
      }

      // Configurar logout
      const btnLogout = document.getElementById('btnLogout');
      if (btnLogout) {
        btnLogout.addEventListener('click', () => {
          window.supabaseSystem.auth.logout();
        });
      }

      const sidebarLogout = document.getElementById('sidebarLogout');
      if (sidebarLogout) {
        sidebarLogout.addEventListener('click', (e) => {
          e.preventDefault();
          window.supabaseSystem.auth.logout();
        });
      }
    });
  </script>
</body>
</html>
