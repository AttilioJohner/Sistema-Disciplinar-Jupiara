<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configura√ß√µes - Dashboard Disciplinar</title>
    
    <!-- CSS Externos -->
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/components.css">
    <link rel="stylesheet" href="../assets/css/dashboard.css">
    
    <!-- Sistema de Autentica√ß√£o Supabase -->
    <script src="../netlify-env.js" onerror="console.log('Vari√°veis do Netlify n√£o encontradas')"></script>
    <script src="../assets/js/env-config.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="../assets/js/unified-auth.js"></script>
    <script src="../assets/js/supabase-only.js"></script>
    
    <!-- GitHub Sync -->
    <script src="../assets/js/github-sync.js"></script>
</head>

<body>
    <!-- BARRA SUPERIOR -->
    <div class="top-bar">
        <div class="top-bar-left">
            <div class="app-launcher">
                <span></span><span></span><span></span>
                <span></span><span></span><span></span>
                <span></span><span></span><span></span>
            </div>
            <span class="app-name">Dashboard Disciplinar</span>
        </div>
        <div class="top-bar-center">
            <input type="text" class="search-box" placeholder="Pesquisar configura√ß√µes...">
        </div>
        <div class="top-bar-right">
            <div class="user-profile">A</div>
        </div>
    </div>

    <!-- LAYOUT PRINCIPAL -->
    <div class="main-layout">
        
        <!-- SIDEBAR -->
        <div class="sidebar">
            <div class="sidebar-section">
                <div class="sidebar-title">M√≥dulos Principais</div>
                
                <a href="../index.html" class="sidebar-item">
                    <span class="sidebar-icon">üè†</span>
                    <span class="sidebar-text">Dashboard</span>
                </a>
                
                
                <a href="gestao-alunos.html" class="sidebar-item">
                    <span class="sidebar-icon">üë•</span>
                    <span class="sidebar-text">Gest√£o de Alunos</span>
                </a>
                
                <a href="medidas-disciplinares.html" class="sidebar-item">
                    <span class="sidebar-icon">üìã</span>
                    <span class="sidebar-text">Medidas Disciplinares</span>
                </a>
                
                <a href="frequencia.html" class="sidebar-item">
                    <span class="sidebar-icon">üìÖ</span>
                    <span class="sidebar-text">Controle de Frequ√™ncia</span>
                </a>
                
                <a href="relatorios.html" class="sidebar-item">
                    <span class="sidebar-icon">üìä</span>
                    <span class="sidebar-text">Relat√≥rios</span>
                </a>
                
                <a href="analises.html" class="sidebar-item">
                    <span class="sidebar-icon">üìà</span>
                    <span class="sidebar-text">An√°lises</span>
                </a>
            </div>
            
            <div class="sidebar-section">
                <div class="sidebar-title">Ferramentas</div>
                
                <a href="configuracoes.html" class="sidebar-item active">
                    <span class="sidebar-icon">‚öôÔ∏è</span>
                    <span class="sidebar-text">Configura√ß√µes</span>
                </a>
                
                <a href="comunicacao.html" class="sidebar-item">
                    <span class="sidebar-icon">üì±</span>
                    <span class="sidebar-text">Comunica√ß√£o</span>
                </a>
                
                <a href="login.html" class="sidebar-item">
                    <span class="sidebar-icon">üîê</span>
                    <span class="sidebar-text">Login/Logout</span>
                </a>
            </div>
        </div>

        <!-- √ÅREA DE CONTE√öDO -->
        <div class="content-area">
            <div class="main-content">
                
                <!-- T√çTULO -->
                <div class="module-title">
                    ‚öôÔ∏è Configura√ß√µes do Sistema
                </div>

                <!-- CONFIGURA√á√ïES GERAIS -->
                <div class="data-card">
                    <div class="card-header">
                        <h3 class="card-title">üè´ Configura√ß√µes da Escola</h3>
                        <p class="card-subtitle">Informa√ß√µes b√°sicas da institui√ß√£o de ensino</p>
                    </div>
                    <div class="card-content">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Nome da Escola</label>
                                <input type="text" id="nomeEscola" class="form-input" placeholder="Digite o nome da escola">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ano Letivo</label>
                                <input type="number" id="anoLetivo" class="form-input" value="2025" min="2020" max="2030">
                            </div>
                            <div class="form-group">
                                <label class="form-label">CNPJ/C√≥digo MEC</label>
                                <input type="text" id="cnpjEscola" class="form-input" placeholder="00.000.000/0001-00">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Endere√ßo Completo</label>
                                <input type="text" id="enderecoEscola" class="form-input" placeholder="Rua, n√∫mero, bairro, cidade, CEP">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Telefone</label>
                                <input type="tel" id="telefoneEscola" class="form-input" placeholder="(11) 99999-9999">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Email Institucional</label>
                                <input type="email" id="emailEscola" class="form-input" placeholder="contato@escola.edu.br">
                            </div>
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-primary" onclick="salvarConfiguracoesEscola()">
                                üíæ Salvar Configura√ß√µes da Escola
                            </button>
                        </div>
                    </div>
                </div>

                <!-- CONFIGURA√á√ïES DO SISTEMA -->
                <div class="data-card">
                    <div class="card-header">
                        <h3 class="card-title">üîß Configura√ß√µes do Sistema</h3>
                        <p class="card-subtitle">Personalize o comportamento e apar√™ncia do sistema</p>
                    </div>
                    <div class="card-content">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Limite de Faltas para Alerta</label>
                                <input type="number" id="limiteFaltas" class="form-input" value="10" min="1" max="50">
                                <small class="form-help">N√∫mero de faltas para gerar alerta autom√°tico</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Backup Autom√°tico (dias)</label>
                                <input type="number" id="diasBackup" class="form-input" value="7" min="1" max="30">
                                <small class="form-help">Intervalo entre backups autom√°ticos</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Formato de Data</label>
                                <select id="formatoData" class="form-input">
                                    <option value="DD/MM/YYYY">DD/MM/YYYY (brasileiro)</option>
                                    <option value="MM/DD/YYYY">MM/DD/YYYY (americano)</option>
                                    <option value="YYYY-MM-DD">YYYY-MM-DD (ISO)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Tema do Sistema</label>
                                <select id="temaSistema" class="form-input">
                                    <option value="claro">üåû Tema Claro</option>
                                    <option value="escuro">üåô Tema Escuro</option>
                                    <option value="auto">üîÑ Autom√°tico</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Notifica√ß√µes por Email</label>
                                <select id="notificacoesEmail" class="form-input">
                                    <option value="todas">üìß Todas as Notifica√ß√µes</option>
                                    <option value="importantes">‚ö†Ô∏è Apenas Importantes</option>
                                    <option value="nenhuma">üîï Desabilitadas</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Idioma do Sistema</label>
                                <select id="idiomaSistema" class="form-input">
                                    <option value="pt-BR">üáßüá∑ Portugu√™s (Brasil)</option>
                                    <option value="en-US">üá∫üá∏ English (US)</option>
                                    <option value="es-ES">üá™üá∏ Espa√±ol</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-primary" onclick="salvarConfigracoesSistema()">
                                ‚öôÔ∏è Salvar Configura√ß√µes do Sistema
                            </button>
                        </div>
                    </div>
                </div>

                <!-- CONFIGURA√á√ïES DE SEGURAN√áA -->
                <div class="data-card security-card">
                    <div class="card-header">
                        <h3 class="card-title">üîí Configura√ß√µes de Seguran√ßa</h3>
                        <p class="card-subtitle">Gerencie a seguran√ßa e privacidade do sistema</p>
                    </div>
                    <div class="card-content">
                        <div class="security-warning">
                            <div class="alert alert-warning">
                                <span class="alert-icon">‚ö†Ô∏è</span>
                                <div class="alert-content">
                                    <strong>Aten√ß√£o:</strong> Altera√ß√µes nas configura√ß√µes de seguran√ßa podem afetar o acesso ao sistema.
                                </div>
                            </div>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Tempo de Sess√£o</label>
                                <input type="number" id="tempoSessao" class="form-input" value="60" min="15" max="480">
                                <small class="form-help">Minutos de inatividade para logout autom√°tico</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Pol√≠tica de Senhas</label>
                                <select id="politicaSenhas" class="form-input">
                                    <option value="basica">üîê B√°sica (6+ caracteres)</option>
                                    <option value="intermediaria">üîí Intermedi√°ria (8+ com n√∫meros)</option>
                                    <option value="avancada">üõ°Ô∏è Avan√ßada (12+ com s√≠mbolos)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Autentica√ß√£o de Dois Fatores</label>
                                <select id="autenticacao2FA" class="form-input">
                                    <option value="desabilitada">‚ùå Desabilitada</option>
                                    <option value="opcional">üîì Opcional</option>
                                    <option value="obrigatoria">üîê Obrigat√≥ria</option>
                                </select>
                                <small class="form-help">Recomendamos ativar para maior seguran√ßa</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Log de Atividades</label>
                                <select id="logAtividades" class="form-input">
                                    <option value="completo">üìä Completo</option>
                                    <option value="basico">üìù B√°sico</option>
                                    <option value="desabilitado">üö´ Desabilitado</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-warning" onclick="salvarConfiguracoeSeguranca()">
                                üîí Salvar Configura√ß√µes de Seguran√ßa
                            </button>
                        </div>
                    </div>
                </div>

                <!-- GEST√ÉO DE USU√ÅRIOS -->
                <div class="data-card users-card">
                    <div class="card-header">
                        <h3 class="card-title">üë• Gest√£o de Usu√°rios</h3>
                        <p class="card-subtitle">Adicione e gerencie usu√°rios do sistema</p>
                    </div>
                    <div class="card-content">
                        <!-- Instru√ß√µes da Tabela (se necess√°rio) -->
                        <div class="alert alert-info" id="tabelaInstructions" style="display: none; margin-bottom: 20px;">
                            <span class="alert-icon">‚ÑπÔ∏è</span>
                            <div class="alert-content">
                                <strong>Configura√ß√£o Necess√°ria:</strong> Para usar a gest√£o completa de usu√°rios, execute este SQL no Supabase:
                                <pre style="background: #f8f9fa; padding: 10px; margin: 10px 0; border-radius: 4px; font-size: 12px; overflow-x: auto;">
CREATE TABLE usuarios_sistema (
  id SERIAL PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id),
  email VARCHAR(255) UNIQUE NOT NULL,
  username VARCHAR(50) UNIQUE NOT NULL,
  nome_completo VARCHAR(255) NOT NULL,
  role VARCHAR(20) DEFAULT 'user',
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Permitir acesso √† tabela
ALTER TABLE usuarios_sistema ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Usu√°rios podem ver todos" ON usuarios_sistema FOR SELECT USING (true);
CREATE POLICY "Usu√°rios podem inserir" ON usuarios_sistema FOR INSERT WITH CHECK (true);
                                </pre>
                            </div>
                        </div>

                        <!-- Adicionar Novo Usu√°rio -->
                        <div class="form-section">
                            <h4>‚ûï Adicionar Novo Usu√°rio</h4>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Email</label>
                                    <input type="email" id="novoUsuarioEmail" class="form-input" placeholder="usuario@escola.edu.br">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Nome de Usu√°rio</label>
                                    <input type="text" id="novoUsuarioUsername" class="form-input" placeholder="usuario123" maxlength="20">
                                    <small class="form-help">Nome para login (sem espa√ßos, apenas letras e n√∫meros)</small>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Nome Completo</label>
                                    <input type="text" id="novoUsuarioNome" class="form-input" placeholder="Nome do usu√°rio">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Senha Inicial</label>
                                    <input type="password" id="novoUsuarioSenha" class="form-input" placeholder="M√≠nimo 6 caracteres">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Papel no Sistema</label>
                                    <select id="novoUsuarioRole" class="form-input">
                                        <option value="user">üë§ Usu√°rio (Consulta)</option>
                                        <option value="teacher">üë®‚Äçüè´ Professor (Lan√ßamentos)</option>
                                        <option value="admin">üëë Administrador (Total)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button class="btn btn-success" onclick="criarNovoUsuario()">
                                    ‚ûï Criar Usu√°rio
                                </button>
                                <button class="btn btn-secondary" onclick="criarUsuarioGitHub()">
                                    üêô Criar com Email do GitHub
                                </button>
                            </div>
                        </div>

                        <!-- Lista de Usu√°rios -->
                        <div class="users-list">
                            <h4>üìã Usu√°rios Cadastrados</h4>
                            <div id="usuariosList" class="users-table">
                                <!-- Ser√° preenchido via JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CONFIGURA√á√ïES DE SINCRONIZA√á√ÉO GITHUB -->
                <div class="data-card github-card">
                    <div class="card-header">
                        <h3 class="card-title">üêô Sincroniza√ß√£o GitHub</h3>
                        <p class="card-subtitle">Configure a sincroniza√ß√£o autom√°tica de dados para trabalho em equipe</p>
                    </div>
                    <div class="card-content">
                        <div class="github-status" id="githubStatus">
                            <div class="alert alert-warning">
                                <span class="alert-icon">‚ö†Ô∏è</span>
                                <div class="alert-content">
                                    <strong>Sincroniza√ß√£o n√£o configurada</strong> - Configure um token GitHub para habilitar sincroniza√ß√£o autom√°tica entre m√∫ltiplos usu√°rios.
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Token GitHub</label>
                                <input type="password" id="githubToken" class="form-input" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx">
                                <small class="form-help">Token de acesso pessoal com permiss√µes de reposit√≥rio</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Email do Usu√°rio</label>
                                <input type="email" id="githubEmail" class="form-input" placeholder="seu-email@escola.edu.br">
                                <small class="form-help">Email para identifica√ß√£o nos commits</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Nome do Usu√°rio</label>
                                <input type="text" id="githubNome" class="form-input" placeholder="Seu Nome">
                                <small class="form-help">Nome que aparecer√° nos commits</small>
                            </div>
                        </div>
                        
                        <div class="github-info">
                            <div class="info-box">
                                <h4>üìã Como obter um Token GitHub:</h4>
                                <ol class="steps-list">
                                    <li>Acesse <a href="https://github.com/settings/tokens" target="_blank">GitHub Settings ‚Üí Tokens</a></li>
                                    <li>Clique em "Generate new token" ‚Üí "Classic"</li>
                                    <li>Selecione as permiss√µes: <code>repo</code> (acesso completo ao reposit√≥rio)</li>
                                    <li>Copie o token gerado e cole no campo acima</li>
                                </ol>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button class="btn btn-success" onclick="configurarGitHub()">
                                üîó Conectar GitHub
                            </button>
                            <button class="btn btn-secondary" onclick="testarConexaoGitHub()" id="testarBtn" disabled>
                                üß™ Testar Conex√£o
                            </button>
                            <button class="btn btn-warning" onclick="desconectarGitHub()" id="desconectarBtn" disabled>
                                üîì Desconectar
                            </button>
                        </div>
                    </div>
                </div>

                <!-- GERENCIAMENTO DE DADOS -->
                <div class="data-card">
                    <div class="card-header">
                        <h3 class="card-title">üíæ Gerenciamento de Dados</h3>
                        <p class="card-subtitle">Backup, restaura√ß√£o e manuten√ß√£o dos dados do sistema</p>
                    </div>
                    <div class="card-content">
                        <div class="data-actions-grid">
                            <div class="action-card backup">
                                <div class="action-icon">üíæ</div>
                                <div class="action-content">
                                    <h4 class="action-title">Backup Completo</h4>
                                    <p class="action-description">Fa√ßa backup de todos os dados para evitar perdas</p>
                                    <button class="btn btn-info" onclick="fazerBackupCompleto()">
                                        üíæ Fazer Backup Agora
                                    </button>
                                </div>
                            </div>
                            
                            <div class="action-card restore">
                                <div class="action-icon">üìÇ</div>
                                <div class="action-content">
                                    <h4 class="action-title">Restaurar Dados</h4>
                                    <p class="action-description">Restaurar dados a partir de um arquivo de backup</p>
                                    <input type="file" id="arquivoRestore" accept=".json" class="form-input" style="margin-bottom: 10px;">
                                    <button class="btn btn-warning" onclick="restaurarBackup()">
                                        üìÇ Restaurar Backup
                                    </button>
                                </div>
                            </div>
                            
                            <div class="action-card export">
                                <div class="action-icon">üìä</div>
                                <div class="action-content">
                                    <h4 class="action-title">Exportar Dados</h4>
                                    <p class="action-description">Exportar todos os dados em formato CSV</p>
                                    <div class="export-buttons">
                                        <button class="btn btn-success" onclick="exportarAlunos()">
                                            üë• Alunos
                                        </button>
                                        <button class="btn btn-success" onclick="exportarMedidas()">
                                            üìã Medidas
                                        </button>
                                        <button class="btn btn-success" onclick="exportarTodosDados()">
                                            üìä Tudo
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="action-card danger">
                                <div class="action-icon">üóëÔ∏è</div>
                                <div class="action-content">
                                    <h4 class="action-title">Limpeza de Dados</h4>
                                    <p class="action-description">‚ö†Ô∏è <strong>CUIDADO:</strong> A√ß√£o irrevers√≠vel</p>
                                    <div class="danger-zone">
                                        <button class="btn btn-secondary" onclick="limparDadosAntigos()">
                                            üóëÔ∏è Limpar Dados Antigos
                                        </button>
                                        <button class="btn btn-danger" onclick="resetarSistema()" style="margin-top: 5px;">
                                            ‚ö†Ô∏è Reset Completo
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- ESTAT√çSTICAS E INFORMA√á√ïES -->
                <div class="data-card">
                    <div class="card-header">
                        <h3 class="card-title">üìä Estat√≠sticas do Sistema</h3>
                        <p class="card-subtitle">Informa√ß√µes sobre uso e performance do sistema</p>
                    </div>
                    <div class="card-content">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-icon">üì±</div>
                                <div class="stat-content">
                                    <div class="stat-number">v1.0</div>
                                    <div class="stat-label">Vers√£o Atual</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">üìä</div>
                                <div class="stat-content">
                                    <div class="stat-number" id="totalRegistros">0</div>
                                    <div class="stat-label">Total Registros</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">üíæ</div>
                                <div class="stat-content">
                                    <div class="stat-number" id="espacoUsado">0 KB</div>
                                    <div class="stat-label">Espa√ßo Usado</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">‚è∞</div>
                                <div class="stat-content">
                                    <div class="stat-number" id="ultimoBackup">Nunca</div>
                                    <div class="stat-label">√öltimo Backup</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- SOBRE O SISTEMA -->
                <div class="data-card info-card">
                    <div class="card-header">
                        <h3 class="card-title">‚ÑπÔ∏è Sobre o Sistema</h3>
                        <p class="card-subtitle">Informa√ß√µes t√©cnicas e de desenvolvimento</p>
                    </div>
                    <div class="card-content">
                        <div class="system-info">
                            <div class="info-section">
                                <h4 class="info-title">üìã Dashboard Disciplinar</h4>
                                <p class="info-description">
                                    Sistema completo de gest√£o disciplinar escolar desenvolvido para facilitar 
                                    o controle de frequ√™ncia, medidas disciplinares e comunica√ß√£o com respons√°veis.
                                </p>
                            </div>
                            <div class="tech-stack">
                                <h4 class="info-title">üõ†Ô∏è Tecnologias</h4>
                                <div class="tech-badges">
                                    <span class="tech-badge">HTML5</span>
                                    <span class="tech-badge">CSS3</span>
                                    <span class="tech-badge">JavaScript</span>
                                    <span class="tech-badge">LocalStorage</span>
                                    <span class="tech-badge">PWA Ready</span>
                                </div>
                            </div>
                            <div class="info-section">
                                <h4 class="info-title">üîß Funcionalidades</h4>
                                <ul class="features-list">
                                    <li>Gest√£o completa de alunos e turmas</li>
                                    <li>Controle de frequ√™ncia automatizado</li>
                                    <li>Sistema de medidas disciplinares</li>
                                    <li>Portal de consulta para pais</li>
                                    <li>Relat√≥rios e an√°lises detalhadas</li>
                                    <li>Backup e exporta√ß√£o de dados</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- JAVASCRIPT -->
    <script src="../assets/js/main.js" defer></script>
    
    <script>
        // Inicializa√ß√£o da p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            console.log('‚öôÔ∏è P√°gina de Configura√ß√µes carregada');
            inicializarConfiguracoes();
        });

        // Fun√ß√£o de inicializa√ß√£o
        function inicializarConfiguracoes() {
            carregarConfiguracoesSalvas();
            atualizarEstatisticasSistema();
            
            // Aguardar carregamento dos sistemas
            setTimeout(() => {
                verificarStatusGitHub();
                carregarListaUsuarios();
            }, 1000);
        }

        // Carregar configura√ß√µes salvas
        function carregarConfiguracoesSalvas() {
            // Configura√ß√µes padr√£o (sem localStorage)
            const configs = {
                nomeEscola: '',
                anoLetivo: new Date().getFullYear(),
                cnpjEscola: '',
                enderecoEscola: '',
                telefoneEscola: '',
                emailEscola: '',
                limiteFaltas: '10',
                diasBackup: '7',
                formatoData: 'DD/MM/YYYY',
                temaSistema: 'claro',
                notificacoesEmail: 'importantes',
                idiomaSistema: 'pt-BR',
                tempoSessao: '60',
                politicaSenhas: 'basica',
                autenticacao2FA: 'desabilitada',
                logAtividades: 'basico'
            };

            // Aplicar valores aos campos
            Object.keys(configs).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    element.value = configs[key];
                }
            });
        }

        // Atualizar estat√≠sticas do sistema
        async function atualizarEstatisticasSistema() {
            try {
                let totalRegistros = 0;
                
                // Usar apenas sistema Supabase
                try {
                    const alunos = {};
                    const medidas = [];
                    const alunosCount = Object.keys(alunos).length;
                    const medidasCount = medidas.length;
                    
                    totalRegistros = alunosCount + medidasCount;
                    
                    console.log(`üìä Estat√≠sticas: ${alunosCount} alunos, ${medidasCount} medidas`);
                } catch (e) {
                    console.warn('Erro ao contar registros:', e);
                }
                
                // Atualizar interface
                const totalElement = document.getElementById('totalRegistros');
                if (totalElement) {
                    totalElement.textContent = totalRegistros;
                }
                
                // Simular espa√ßo usado (estimativa b√°sica)
                const espacoEstimado = Math.round(totalRegistros * 0.5); // 0.5KB por registro
                const espacoElement = document.getElementById('espacoUsado');
                if (espacoElement) {
                    espacoElement.textContent = espacoEstimado + ' KB';
                }
                
                // √öltimo backup
                const ultimoBackup = 'Nunca';
                const backupElement = document.getElementById('ultimoBackup');
                if (backupElement) {
                    backupElement.textContent = ultimoBackup;
                }
                
            } catch (error) {
                console.error('Erro ao atualizar estat√≠sticas:', error);
            }
        }

        // Salvar configura√ß√µes
        function salvarConfiguracoesEscola() {
            const configs = {
                nomeEscola: document.getElementById('nomeEscola').value,
                anoLetivo: document.getElementById('anoLetivo').value,
                cnpjEscola: document.getElementById('cnpjEscola').value,
                enderecoEscola: document.getElementById('enderecoEscola').value,
                telefoneEscola: document.getElementById('telefoneEscola').value,
                emailEscola: document.getElementById('emailEscola').value
            };

            try {
                // Configura√ß√µes da escola (apenas valida√ß√£o)
                console.log('Configura√ß√µes da escola validadas:', configs);
                showMessage('‚úÖ Configura√ß√µes da escola salvas!', 'success');
            } catch (error) {
                showMessage('Erro ao salvar configura√ß√µes', 'error');
            }
        }

        function salvarConfigracoesSistema() {
            const configs = {
                limiteFaltas: document.getElementById('limiteFaltas').value,
                diasBackup: document.getElementById('diasBackup').value,
                formatoData: document.getElementById('formatoData').value,
                temaSistema: document.getElementById('temaSistema').value,
                notificacoesEmail: document.getElementById('notificacoesEmail').value,
                idiomaSistema: document.getElementById('idiomaSistema').value
            };

            try {
                // Configura√ß√µes do sistema (apenas valida√ß√£o)
                console.log('Configura√ß√µes do sistema validadas:', configs);
                showMessage('‚úÖ Configura√ß√µes do sistema salvas!', 'success');
                
                // Aplicar tema se mudou
                aplicarTema(configs.temaSistema);
            } catch (error) {
                showMessage('Erro ao salvar configura√ß√µes', 'error');
            }
        }

        function salvarConfiguracoeSeguranca() {
            const configs = {
                tempoSessao: document.getElementById('tempoSessao').value,
                politicaSenhas: document.getElementById('politicaSenhas').value,
                autenticacao2FA: document.getElementById('autenticacao2FA').value,
                logAtividades: document.getElementById('logAtividades').value
            };

            try {
                // Configura√ß√µes de seguran√ßa (apenas valida√ß√£o)
                console.log('Configura√ß√µes de seguran√ßa validadas:', configs);
                showMessage('‚úÖ Configura√ß√µes de seguran√ßa salvas!', 'success');
            } catch (error) {
                showMessage('Erro ao salvar configura√ß√µes', 'error');
            }
        }

        // Fun√ß√µes de dados
        async function fazerBackupCompleto() {
            try {
                await fazerBackup();
                console.log('Backup realizado em:', new Date().toLocaleDateString('pt-BR'));
                atualizarEstatisticasSistema();
            } catch (error) {
                showMessage('Erro ao fazer backup', 'error');
            }
        }

        async function restaurarBackup() {
            const arquivo = document.getElementById('arquivoRestore').files[0];
            if (!arquivo) {
                showMessage('Por favor, selecione um arquivo de backup', 'warning');
                return;
            }
            
            try {
                const texto = await arquivo.text();
                const dados = JSON.parse(texto);
                
                // Validar estrutura do backup
                if (dados.alunos || dados.medidas || dados.configuracoes) {
                    // Dados importados (apenas log)
                    console.log('Dados importados:', dados);
                    
                    showMessage('‚úÖ Backup restaurado com sucesso!', 'success');
                    setTimeout(() => window.location.reload(), 2000);
                } else {
                    showMessage('Arquivo de backup inv√°lido', 'error');
                }
            } catch (error) {
                showMessage('Erro ao restaurar backup: arquivo corrompido', 'error');
            }
        }

        function exportarAlunos() {
            // Exportar dados do Supabase (n√£o implementado)
            const alunos = [];
            
            if (alunos.length === 0) {
                showMessage('Nenhum aluno encontrado para exportar', 'warning');
                return;
            }
            
            const csv = convertToCSV(alunos, ['codigo', 'nome_completo', 'turma', 'responsavel']);
            downloadCSV(csv, 'alunos_' + new Date().toISOString().slice(0, 10) + '.csv');
            showMessage('‚úÖ Dados de alunos exportados!', 'success');
        }
        
        function exportarMedidas() {
            // Medidas disciplinares (n√£o implementado)
            const medidas = [];
            
            if (medidas.length === 0) {
                showMessage('Nenhuma medida encontrada para exportar', 'warning');
                return;
            }
            
            const csv = convertToCSV(medidas, ['data', 'aluno', 'tipo', 'descricao', 'professor']);
            downloadCSV(csv, 'medidas_' + new Date().toISOString().slice(0, 10) + '.csv');
            showMessage('‚úÖ Medidas disciplinares exportadas!', 'success');
        }

        function exportarTodosDados() {
            const todosOsDados = {
                alunos: {},
                medidas: [],
                configuracoes: {
                    nomeEscola: '',
                    anoLetivo: new Date().getFullYear(),
                    cnpjEscola: '',
                    enderecoEscola: '',
                    telefoneEscola: '',
                    emailEscola: ''
                },
                exportadoEm: new Date().toISOString()
            };
            
            const json = JSON.stringify(todosOsDados, null, 2);
            downloadJSON(json, 'backup_completo_' + new Date().toISOString().slice(0, 10) + '.json');
            showMessage('‚úÖ Backup completo exportado!', 'success');
        }

        function limparDadosAntigos() {
            if (confirm('ATEN√á√ÉO: Esta a√ß√£o ir√° remover registros com mais de 1 ano permanentemente.\n\nTem certeza que deseja continuar?')) {
                try {
                    const medidas = JSON.parse(localStorage.getItem('medidas') || '[]');
                    const dataLimite = new Date();
                    dataLimite.setFullYear(dataLimite.getFullYear() - 1);
                    
                    const medidasRecentes = medidas.filter(medida => {
                        const dataMedida = new Date(medida.data);
                        return dataMedida >= dataLimite;
                    });
                    
                    console.log('Medidas filtradas:', medidasRecentes);
                    const removidos = medidas.length - medidasRecentes.length;
                    
                    showMessage(`‚úÖ ${removidos} registros antigos removidos!`, 'success');
                    atualizarEstatisticasSistema();
                } catch (error) {
                    showMessage('Erro ao limpar dados antigos', 'error');
                }
            }
        }
        
        function resetarSistema() {
            if (confirm('‚ö†Ô∏è ATEN√á√ÉO: Esta a√ß√£o ir√° APAGAR TODOS OS DADOS do sistema!\n\nEsta a√ß√£o √© IRREVERS√çVEL!\n\nDigite "CONFIRMAR" para continuar:')) {
                const confirmacao = prompt('Digite "CONFIRMAR" para resetar o sistema:');
                if (confirmacao === 'CONFIRMAR') {
                    // Fazer backup antes do reset
                    exportarTodosDados();
                    
                    // Reset do sistema solicitado
                    console.log('Reset do sistema solicitado');
                    
                    showMessage('üîÑ Sistema resetado! Backup salvo automaticamente.', 'info');
                    setTimeout(() => window.location.href = '../index.html', 3000);
                } else {
                    showMessage('Reset cancelado', 'info');
                }
            }
        }

        // Aplicar tema
        function aplicarTema(tema) {
            // Implementa√ß√£o b√°sica de tema
            const body = document.body;
            body.classList.remove('tema-claro', 'tema-escuro');
            
            if (tema === 'escuro') {
                body.classList.add('tema-escuro');
            } else if (tema === 'auto') {
                const isEscuro = window.matchMedia('(prefers-color-scheme: dark)').matches;
                body.classList.add(isEscuro ? 'tema-escuro' : 'tema-claro');
            } else {
                body.classList.add('tema-claro');
            }
        }

        // Fun√ß√µes auxiliares para exporta√ß√£o
        function convertToCSV(data, headers) {
            const csvHeaders = headers.join(',');
            const csvRows = data.map(item => {
                return headers.map(header => {
                    const value = item[header] || '';
                    return `"${String(value).replace(/"/g, '""')}"`;
                }).join(',');
            });
            return [csvHeaders, ...csvRows].join('\n');
        }
        
        function downloadCSV(csv, filename) {
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
            URL.revokeObjectURL(link.href);
        }
        
        function downloadJSON(json, filename) {
            const blob = new Blob([json], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
            URL.revokeObjectURL(link.href);
        }
        
        // Sistema de mensagens
        function showMessage(message, type = 'info') {
            // Remove mensagens anteriores
            const existingAlert = document.querySelector('.floating-alert');
            if (existingAlert) existingAlert.remove();
            
            // Cria nova mensagem
            const alert = document.createElement('div');
            alert.className = `floating-alert alert-${type}`;
            alert.innerHTML = `
                <span class="alert-icon">${getAlertIcon(type)}</span>
                <span class="alert-text">${message}</span>
                <span class="alert-close" onclick="this.parentElement.remove()">√ó</span>
            `;
            
            document.body.appendChild(alert);
            
            // Remove automaticamente ap√≥s 5 segundos
            setTimeout(() => {
                if (alert.parentElement) alert.remove();
            }, 5000);
        }
        
        function getAlertIcon(type) {
            const icons = {
                success: '‚úÖ',
                error: '‚ùå',
                warning: '‚ö†Ô∏è',
                info: '‚ÑπÔ∏è'
            };
            return icons[type] || '‚ÑπÔ∏è';
        }

        // ============================================
        //           FUN√á√ïES DO GITHUB
        // ============================================
        
        // Verificar status do GitHub ao carregar
        function verificarStatusGitHub() {
            const statusDiv = document.getElementById('githubStatus');
            const testarBtn = document.getElementById('testarBtn');
            const desconectarBtn = document.getElementById('desconectarBtn');
            
            if (window.gitHubSync && window.gitHubSync.podeEscrever()) {
                // GitHub configurado
                statusDiv.innerHTML = `
                    <div class="alert alert-success">
                        <span class="alert-icon">‚úÖ</span>
                        <div class="alert-content">
                            <strong>GitHub conectado!</strong> Sincroniza√ß√£o autom√°tica ativada para: ${window.gitHubSync.userName}
                        </div>
                    </div>
                `;
                
                // Preencher campos
                document.getElementById('githubEmail').value = window.gitHubSync.userEmail || '';
                document.getElementById('githubNome').value = window.gitHubSync.userName || '';
                
                testarBtn.disabled = false;
                desconectarBtn.disabled = false;
            } else {
                // GitHub n√£o configurado
                statusDiv.innerHTML = `
                    <div class="alert alert-warning">
                        <span class="alert-icon">‚ö†Ô∏è</span>
                        <div class="alert-content">
                            <strong>Sincroniza√ß√£o n√£o configurada</strong> - Configure um token GitHub para habilitar sincroniza√ß√£o autom√°tica entre m√∫ltiplos usu√°rios.
                        </div>
                    </div>
                `;
                
                testarBtn.disabled = true;
                desconectarBtn.disabled = true;
            }
        }
        
        // Configurar GitHub
        async function configurarGitHub() {
            const token = document.getElementById('githubToken').value.trim();
            const email = document.getElementById('githubEmail').value.trim();
            const nome = document.getElementById('githubNome').value.trim();
            
            if (!token) {
                showMessage('Por favor, insira o token GitHub', 'error');
                return;
            }
            
            if (!email) {
                showMessage('Por favor, insira seu email', 'error');
                return;
            }
            
            if (!nome) {
                showMessage('Por favor, insira seu nome', 'error');
                return;
            }
            
            try {
                showMessage('üîÑ Testando conex√£o com GitHub...', 'info');
                
                const sucesso = await window.gitHubSync.configurarGitHub(token, email, nome);
                
                if (sucesso) {
                    showMessage('‚úÖ GitHub configurado com sucesso!', 'success');
                    verificarStatusGitHub();
                    
                    // Limpar campo de token por seguran√ßa
                    document.getElementById('githubToken').value = '';
                } else {
                    showMessage('‚ùå Falha na configura√ß√£o do GitHub', 'error');
                }
                
            } catch (error) {
                console.error('Erro ao configurar GitHub:', error);
                showMessage(`Erro: ${error.message}`, 'error');
            }
        }
        
        // Testar conex√£o GitHub
        async function testarConexaoGitHub() {
            try {
                showMessage('üß™ Testando conex√£o...', 'info');
                
                const isValid = await window.gitHubSync.validarToken();
                
                if (isValid) {
                    showMessage('‚úÖ Conex√£o com GitHub funcionando perfeitamente!', 'success');
                    
                    // Testar sincroniza√ß√£o
                    const dados = await window.gitHubSync.sincronizarAutomatico();
                    if (dados) {
                        showMessage('üì° Sincroniza√ß√£o de dados realizada com sucesso!', 'success');
                    } else {
                        showMessage('‚ö†Ô∏è Conex√£o OK, mas sem dados para sincronizar', 'warning');
                    }
                } else {
                    showMessage('‚ùå Token inv√°lido ou expirado', 'error');
                }
                
            } catch (error) {
                console.error('Erro no teste:', error);
                showMessage(`Erro no teste: ${error.message}`, 'error');
            }
        }
        
        // Desconectar GitHub
        function desconectarGitHub() {
            if (confirm('Tem certeza que deseja desconectar o GitHub?\n\nIsso desabilitar√° a sincroniza√ß√£o autom√°tica.')) {
                window.gitHubSync.logout();
                
                // Limpar campos
                document.getElementById('githubToken').value = '';
                document.getElementById('githubEmail').value = '';
                document.getElementById('githubNome').value = '';
                
                verificarStatusGitHub();
                showMessage('üîì GitHub desconectado', 'info');
            }
        }

        // ============================================
        //           FUN√á√ïES DE GEST√ÉO DE USU√ÅRIOS
        // ============================================
        
        // Carregar lista de usu√°rios
        async function carregarListaUsuarios() {
            const container = document.getElementById('usuariosList');
            
            try {
                // Aguardar Supabase estar dispon√≠vel
                if (!window.supabaseClient) {
                    if (container) {
                        container.innerHTML = '<p class="no-users">‚è≥ Carregando sistema de autentica√ß√£o...</p>';
                    }
                    setTimeout(carregarListaUsuarios, 1000);
                    return;
                }
                
                // Verificar se usu√°rio est√° autenticado
                if (!window.unifiedAuth || !window.unifiedAuth.isAuthenticated()) {
                    if (container) {
                        container.innerHTML = '<p class="no-users">‚è≥ Aguardando autentica√ß√£o...</p>';
                    }
                    setTimeout(carregarListaUsuarios, 1000);
                    return;
                }
                
                // Buscar usu√°rios na tabela personalizada (sem usar admin functions)
                const { data: usuarios, error } = await window.supabaseClient
                    .from('usuarios_sistema')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (!container) return;
                
                if (error) {
                    // Se a tabela n√£o existe, mostrar mensagem explicativa
                    if (error.code === '42P01') {
                        // Mostrar instru√ß√µes de configura√ß√£o
                        document.getElementById('tabelaInstructions').style.display = 'block';
                        container.innerHTML = `
                            <p class="no-users">
                                ‚ÑπÔ∏è Tabela de usu√°rios n√£o encontrada.<br>
                                <small>Veja as instru√ß√µes acima para configurar a gest√£o de usu√°rios.</small>
                            </p>
                        `;
                    } else {
                        container.innerHTML = '<p class="no-users">‚ùå Erro ao carregar usu√°rios: ' + error.message + '</p>';
                    }
                    return;
                }
                
                if (!usuarios || usuarios.length === 0) {
                    container.innerHTML = '<p class="no-users">Nenhum usu√°rio cadastrado al√©m do administrador padr√£o.</p>';
                    return;
                }
                
                let html = `
                    <div class="users-header">
                        <span>üìß Email</span>
                        <span>üè∑Ô∏è Username</span>
                        <span>üë§ Nome</span>
                        <span>üëë Papel</span>
                        <span>üìÖ Criado</span>
                        <span>‚öôÔ∏è A√ß√µes</span>
                    </div>
                `;
                
                usuarios.forEach(usuario => {
                    const roleIcon = {
                        'admin': 'üëë',
                        'teacher': 'üë®‚Äçüè´',
                        'user': 'üë§'
                    }[usuario.role] || 'üë§';
                    
                    const roleName = {
                        'admin': 'Administrador',
                        'teacher': 'Professor',
                        'user': 'Usu√°rio'
                    }[usuario.role] || 'Usu√°rio';
                    
                    html += `
                        <div class="user-row">
                            <span class="user-email">${usuario.email}</span>
                            <span class="user-username">${usuario.username || '‚Äî'}</span>
                            <span class="user-name">${usuario.nome_completo}</span>
                            <span class="user-role">${roleIcon} ${roleName}</span>
                            <span class="user-created">${new Date(usuario.created_at).toLocaleDateString('pt-BR')}</span>
                            <span class="user-actions">
                                ${usuario.email !== 'admin@escola.com' ? `
                                    <button class="btn-small btn-warning" onclick="alterarPapelUsuario('${usuario.email}')">
                                        üîÑ Alterar Papel
                                    </button>
                                    <button class="btn-small btn-danger" onclick="excluirUsuario('${usuario.email}')">
                                        üóëÔ∏è Excluir
                                    </button>
                                ` : '<span class="protected-user">üëë Protegido</span>'}
                            </span>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
                
            } catch (error) {
                console.error('Erro ao carregar usu√°rios:', error);
                const container = document.getElementById('usuariosList');
                if (container) {
                    container.innerHTML = '<p class="error-message">Erro ao carregar usu√°rios. Fa√ßa login como administrador.</p>';
                }
            }
        }
        
        // Criar novo usu√°rio
        async function criarNovoUsuario() {
            // Verificar se o sistema est√° carregado
            if (!window.supabaseClient) {
                showMessage('‚ö†Ô∏è Sistema de autentica√ß√£o n√£o carregado. Tente novamente em alguns segundos.', 'warning');
                setTimeout(criarNovoUsuario, 2000);
                return;
            }
            
            const email = document.getElementById('novoUsuarioEmail').value.trim();
            const username = document.getElementById('novoUsuarioUsername').value.trim();
            const nome = document.getElementById('novoUsuarioNome').value.trim();
            const senha = document.getElementById('novoUsuarioSenha').value;
            const role = document.getElementById('novoUsuarioRole').value;
            
            if (!email || !username || !nome || !senha) {
                showMessage('Por favor, preencha todos os campos', 'error');
                return;
            }

            // Validar formato de email (mais permissivo)
            const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
            if (!emailRegex.test(email)) {
                showMessage('Por favor, insira um email v√°lido (ex: usuario@gmail.com)', 'error');
                return;
            }

            // Sugerir dom√≠nios v√°lidos para emails com dom√≠nios suspeitos
            const domain = email.split('@')[1];
            const commonDomains = ['gmail.com', 'hotmail.com', 'outlook.com', 'yahoo.com', 'eecmjupiara.com.br'];
            if (domain === 'email.com') {
                showMessage('‚ö†Ô∏è Use um dom√≠nio de email v√°lido como @gmail.com, @hotmail.com, etc.', 'warning');
                return;
            }
            
            // Validar username (apenas letras, n√∫meros e underscore)
            if (!/^[a-zA-Z0-9_]+$/.test(username)) {
                showMessage('Nome de usu√°rio deve conter apenas letras, n√∫meros e underscore', 'error');
                return;
            }
            
            if (senha.length < 6) {
                showMessage('A senha deve ter pelo menos 6 caracteres', 'error');
                return;
            }
            
            try {
                showMessage('üë§ Criando usu√°rio...', 'info');
                
                // Verificar se username j√° existe na tabela personalizada
                const { data: existingUsers, error: checkError } = await window.supabaseClient
                    .from('usuarios_sistema')
                    .select('username, email')
                    .or(`username.ilike.${username},email.ilike.${email}`);
                
                if (checkError && checkError.code !== '42P01') {
                    throw checkError;
                }
                
                if (existingUsers && existingUsers.length > 0) {
                    const duplicateUsername = existingUsers.find(u => 
                        u.username?.toLowerCase() === username.toLowerCase()
                    );
                    const duplicateEmail = existingUsers.find(u => 
                        u.email?.toLowerCase() === email.toLowerCase()
                    );
                    
                    if (duplicateUsername) {
                        showMessage('Nome de usu√°rio j√° existe. Escolha outro.', 'error');
                        return;
                    }
                    if (duplicateEmail) {
                        showMessage('Email j√° est√° cadastrado.', 'error');
                        return;
                    }
                }
                
                // Criar usu√°rio no Supabase Auth (signup normal)
                const { data: authData, error: authError } = await window.supabaseClient.auth.signUp({
                    email: email,
                    password: senha
                });
                
                if (authError) {
                    console.error('Erro no signup do Supabase:', authError);
                    
                    // Tratar erros espec√≠ficos do Supabase
                    let errorMessage = 'Erro ao criar usu√°rio: ';
                    const errorMsg = authError.message || '';
                    
                    if (errorMsg.includes('Invalid email') || errorMsg.includes('is invalid')) {
                        errorMessage += 'Email inv√°lido. Use um formato v√°lido como usuario@gmail.com';
                    } else if (errorMsg.includes('Password should be at least')) {
                        errorMessage += 'A senha deve ter pelo menos 6 caracteres.';
                    } else if (errorMsg.includes('User already registered') || errorMsg.includes('already been taken')) {
                        errorMessage += 'Este email j√° est√° cadastrado.';
                    } else if (errorMsg.includes('rate limit')) {
                        errorMessage += 'Muitas tentativas. Tente novamente em alguns minutos.';
                    } else {
                        errorMessage += errorMsg || 'Erro desconhecido.';
                    }
                    throw new Error(errorMessage);
                }
                
                // Salvar dados do usu√°rio na tabela personalizada
                if (authData.user) {
                    const { error: insertError } = await window.supabaseClient
                        .from('usuarios_sistema')
                        .insert({
                            user_id: authData.user.id,
                            email: email,
                            username: username,
                            nome_completo: nome,
                            role: role,
                            created_at: new Date().toISOString()
                        });
                    
                    // Se der erro por tabela n√£o existir, mostrar instru√ß√µes
                    if (insertError && insertError.code === '42P01') {
                        showMessage('‚ö†Ô∏è Usu√°rio criado no auth, mas tabela personalizada n√£o encontrada. Funcionalidade limitada.', 'warning');
                    } else if (insertError) {
                        console.error('Erro ao salvar metadados:', insertError);
                        showMessage('‚ö†Ô∏è Usu√°rio criado, mas erro ao salvar metadados.', 'warning');
                    } else {
                        showMessage('‚úÖ Usu√°rio criado com sucesso!', 'success');
                    }
                } else {
                    showMessage('‚úÖ Usu√°rio criado, mas pode precisar confirmar email.', 'success');
                }
                
                // Limpar formul√°rio
                document.getElementById('novoUsuarioEmail').value = '';
                document.getElementById('novoUsuarioUsername').value = '';
                document.getElementById('novoUsuarioNome').value = '';
                document.getElementById('novoUsuarioSenha').value = '';
                document.getElementById('novoUsuarioRole').value = 'user';
                
                // Recarregar lista
                carregarListaUsuarios();
                
            } catch (error) {
                console.error('Erro ao criar usu√°rio:', error);
                showMessage(`Erro: ${error.message}`, 'error');
            }
        }
        
        // Criar usu√°rio com email do GitHub
        async function criarUsuarioGitHub() {
            const githubEmail = window.gitHubSync?.userEmail;
            const githubNome = window.gitHubSync?.userName;
            
            if (!githubEmail) {
                showMessage('Configure o GitHub primeiro para usar esta op√ß√£o', 'warning');
                return;
            }
            
            // Preencher campos
            document.getElementById('novoUsuarioEmail').value = githubEmail;
            document.getElementById('novoUsuarioNome').value = githubNome || githubEmail.split('@')[0];
            document.getElementById('novoUsuarioRole').value = 'admin';
            
            showMessage('üìã Dados do GitHub preenchidos! Defina uma senha e clique em "Criar Usu√°rio"', 'info');
            
            // Focar no campo senha
            document.getElementById('novoUsuarioSenha').focus();
        }
        
        // Excluir usu√°rio
        async function excluirUsuario(email) {
            if (!confirm(`Tem certeza que deseja excluir o usu√°rio:\n\n${email}\n\nEsta a√ß√£o n√£o pode ser desfeita.`)) {
                return;
            }
            
            try {
                showMessage('üóëÔ∏è Excluindo usu√°rio...', 'info');
                
                await window.localAuth.deleteUser(email);
                
                showMessage('‚úÖ Usu√°rio exclu√≠do com sucesso!', 'success');
                carregarListaUsuarios();
                
            } catch (error) {
                console.error('Erro ao excluir usu√°rio:', error);
                showMessage(`Erro: ${error.message}`, 'error');
            }
        }
        
        // Alterar papel do usu√°rio
        async function alterarPapelUsuario(email) {
            const novoRole = prompt(`Alterar papel do usu√°rio ${email}:\n\n1 = Usu√°rio (consulta)\n2 = Professor (lan√ßamentos)\n3 = Administrador (total)\n\nDigite 1, 2 ou 3:`);
            
            if (!novoRole || !['1', '2', '3'].includes(novoRole)) {
                return;
            }
            
            const roleMap = {
                '1': 'user',
                '2': 'teacher', 
                '3': 'admin'
            };
            
            const roleNames = {
                'user': 'Usu√°rio',
                'teacher': 'Professor',
                'admin': 'Administrador'
            };
            
            const newRoleValue = roleMap[novoRole];
            
            try {
                showMessage('üëë Alterando papel...', 'info');
                
                await window.localAuth.updateUserRole(email, newRoleValue);
                
                showMessage(`‚úÖ Papel alterado para: ${roleNames[newRoleValue]}`, 'success');
                carregarListaUsuarios();
                
            } catch (error) {
                console.error('Erro ao alterar papel:', error);
                showMessage(`Erro: ${error.message}`, 'error');
            }
        }

        // Fun√ß√µes expostas globalmente
        window.salvarConfiguracoesEscola = salvarConfiguracoesEscola;
        window.salvarConfigracoesSistema = salvarConfigracoesSistema;
        window.salvarConfiguracoeSeguranca = salvarConfiguracoeSeguranca;
        window.fazerBackupCompleto = fazerBackupCompleto;
        window.restaurarBackup = restaurarBackup;
        window.exportarAlunos = exportarAlunos;
        window.exportarMedidas = exportarMedidas;
        window.exportarTodosDados = exportarTodosDados;
        window.limparDadosAntigos = limparDadosAntigos;
        window.resetarSistema = resetarSistema;
        window.configurarGitHub = configurarGitHub;
        window.testarConexaoGitHub = testarConexaoGitHub;
        window.desconectarGitHub = desconectarGitHub;
        window.criarNovoUsuario = criarNovoUsuario;
        window.criarUsuarioGitHub = criarUsuarioGitHub;
        window.excluirUsuario = excluirUsuario;
        window.alterarPapelUsuario = alterarPapelUsuario;
    </script>
    <script>
  document.addEventListener('DOMContentLoaded', async () => {
    // Aguardar sistema de autentica√ß√£o unificado
    if (window.unifiedAuth) {
        await window.unifiedAuth.waitForReady();
        
        if (window.unifiedAuth.isAuthenticated()) {
            const user = window.unifiedAuth.getCurrentUser();
            console.log("‚úÖ Usu√°rio logado:", user.email);
            
            // Carregar lista de usu√°rios ap√≥s autentica√ß√£o
            setTimeout(carregarListaUsuarios, 1000);
        } else {
            console.log('‚ö†Ô∏è Acesso √† configura√ß√µes sem login - algumas funcionalidades podem estar limitadas');
        }
    } else {
        console.log('‚ö†Ô∏è Sistema de autentica√ß√£o carregando...');
    }
  });
</script>

</body>
</html>
